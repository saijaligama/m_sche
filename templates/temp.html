<!DOCTYPE html>
<html lang="en">
<head>
    <title>Project Screen 1 - Basic Details</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: navy;
            background-size: cover;
            background-position: center;
        }

        .container {
            width: 500px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.8);
        }

        h1 {
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        input[type="text"], input[type="email"], input[type="tel"], textarea, select {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        .submit-button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .submit-button:hover {
            background-color: #45a049;
        }

        #chatbot {
            width: 400px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }

        .question {
            background-color: #5897fb;
            color: white;
            padding: 8px;
            border-radius: 5px;
            text-align: right;
            margin-bottom: 5px;
            width: 70%;
        }

        .response {
            background-color: #fff;
            color: #5897fb;
            padding: 8px;
            border-radius: 5px;
            text-align: left;
            margin-bottom: 5px;
            width: 70%;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
        }

        #userResponse {
            width: 60%;
        }

    </style>
</head>
<body>
<div class="container">

    <h1>Live Chat</h1>

    <div id="chatbot">
        <div id="questions"></div>
    </div>

    <div class="button-container">
        <input type="text" id="userResponse" placeholder="Type your response...">
        <button id="submit" class="submit-button">Submit</button>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="script.js"></script>

<script>
    function startChatbot() {
        const questions = [
            "Thanks for your interest in a quote, which is definitely a good move. Let's start... What's your first name?",
            "What is your last name?",
            "Next about age. You know the quote quality is related to accurate info like age. What's your age?",
            "Could you give your phone number to us so that we better serve you? We will not share it and any other info you give here to any one without your written permission. \n" +
            "The phone number should be 10 digits without any other letters",
            "What is your sex \n" +
            "1. Male \n" +
            "2.Female",
            "What is your email address? ",
            "What is your date of birth \n" + " (YYYY-MM-DD)? ",
            "Your address is required if you request a car/home insurance quote. We have more than 20 providers who can give you competitive quotes. What's your address? ",
            "What state do you live in? \n" + "(AL,NC)",
            "What is your risk class?\n" +
            "1. Preferred Plus Non Tobacco,\n" +
            "2. Preferred Non Tobacco,\n" +
            "3. Standard Plus Non Tobacco,\n" +
            "4. Standard Non Tobacco,\n" +
            "5. Preferred Tobacco,\n" +
            "6. Standard Tobacco \n" + "1. is best",
            "Next how much life insurance or LTC you need? Hm... Good question. Rule of thumb amount is 10 times of your income. More accurate estimate is DIME rule. Contact us for more details. What's the desired face amount? ",
            "What death benefit option (level/increasing)? \n" +
            "1.Level \n" +
            "2. Increasing",
            "What premium mode (monthly/annual)? \n"+
            "1.Monthly \n"+
            "2. Annual",
            "Now let's go to the funding part: how much money is invested in the policy where your extra cash is invested and increased tax deferred and tax free after the deduction of the insurance costs. Target is a suitable amount you can afford. If you mainly use the policy to accumulate your wealth tax free and mask risk free and maximize its benefits, you certainly choose \n" +
            "What premium schedule (maximum/target)? \n"+
            "1. Maximum \n" +
            "2. Target",
            "Next is one of the most important issue called long term care (LTC) which takes care of your costs when two of the six standard ADLs are generally recognized as bathing, dressing, toileting, transferring (getting in and out of bed or chair), eating, and continence. The cost is about $7000-$12000 a month now. Many states are considering the LTC tax from payroll now. One of the best solutions is to add a LTC rider to the policy or buy LTC index-linked policy. You are certainly encouraged to schedule a time to discuss it with our experts. \n"+
            "Select LTC Option \n"+
            "1. LTC Rider\n" +
            "2. Linked Benefit-LTC \n"+
            "3. None"

            // Add more questions as needed
        ];

        const responses = {};
        let currentQuestion = 0;

        let timer;

        function startTimer() {
            // Clear any existing timers
            clearTimeout(timer);

            // Set a new timer for 30 seconds
            timer = setTimeout(function () {
                alert('Are you still there?'); // Display alert after 30 seconds
            }, 30000); // 30 seconds in milliseconds
        }

    function displayQuestions() {
        console.log("inside display questions");
    $('#questions').empty(); // Clear previous content

    for (let i = 0; i < currentQuestion; i++) {
        const formattedQuestion = questions[i].replace(/\n/g, '<br>');
        const formattedResponse = (responses[`q${i}`] || '').replace(/\n/g, '<br>');

        $('#questions').append(`
            <div class="chat-container">
                <div class="question">${formattedQuestion}</div>
                ${formattedResponse ? `<div class="response">${formattedResponse}</div>` : ''}
            </div>
        `);
    }

    if (currentQuestion < questions.length) {
        const formattedQuestion = questions[currentQuestion].replace(/\n/g, '<br>');
        const formattedResponse = (responses[`q${currentQuestion}`] || '').replace(/\n/g, '<br>');

        $('#questions').append(`
            <div class="chat-container">
                <div class="question">${formattedQuestion}</div>
                ${formattedResponse ? `<div class="response">${formattedResponse}</div>` : ''}
            </div>
        `);
        startTimer();
        $('#userResponse').val('');
    }
}


        // Initial display of the questions
        displayQuestions();

function handleButtonClick() {
    const userResponse = $(`#userResponse`).val();
    console.log("Handling button click:", userResponse);

    if (questions[currentQuestion].includes("Select LTC Option \n" +
        "1. LTC Rider\n" +
        "2. Linked Benefit-LTC")) {
        console.log("Handling LTC section");

        if (userResponse.toLowerCase() === "1") {
            console.log("User selected option 1");

            // Handle option 1
            responses[`q${currentQuestion}`] = userResponse;
            currentQuestion++;

            // Ask additional questions
            questions.push(
                "Amount?\n" + "Like the life underwriting, the LTC needs also your health info. The rate you think for you?",
                "Maximum monthly benefit payment as a percentage of the total amount? \n" + "1. 2% \n" + "2. 3% \n" + "3. 4% \n",
                "Rate? \n" + "1. Preferred Tobacco \n" + "2. Tobacco \n" +
                "3. Preferred Non Tobacco \n" + "4. Tobacco",
                "If currently your income is moderate, the most affordable protection is term life insurance where the protection is only for the specified terms without cash accumulation. Which term you like? \n" + "1. 10-Year \n" + "2. 15-Year \n" + "3. 20-Year \n" +
                "4. 30-Year \n" + "5. Permanent",
                "Would you like to schedule a meeting \n" + "1. Yes \n" + "2. No"
                // Add more meeting-related questions as needed
            );

            // Update displayQuestions herea
            displayQuestions();

        } else if (userResponse.toLowerCase() === "2") {
            console.log("User selected option 2");
            // Handle option 2

            responses[`q${currentQuestion}`] = userResponse;
            currentQuestion++;

            questions.push(
                "Premium Schedule?"+ "1. Single \n" + "2. 5-pay \n" + "3. 10-pay \n"
                 + "4. Pay-to-AFS \n",
                "Benefit Durations?" + "1. 2 years \n" + "2. 3 Years \n" + "3. 4 years \n" +
                "4. 5 Years \n" +"5. 6 Years \n" + "6. 7 Years",
                "Inflation Benefit Option?"+"1. None \n" +
                "2. 3 % Simple \n" + "3. 3% Compound \n" +
                "4. 5% Compound \n",
                "Would you like to schedule a meeting \n" + "1. Yes \n" + "2. No"

                // Add more meeting-related questions as needed
            );
            console.log("iiijijij");
            console.log(questions);


            // Update displayQuestions here
            displayQuestions();
        }
        else if (userResponse.toLowerCase() === "3") {
            console.log("User selected option 3");
            // Handle option 2

            responses[`q${currentQuestion}`] = userResponse;
            currentQuestion++;

            questions.push(
                "Would you like to schedule a meeting \n" + "1. Yes \n" + "2. No"

                // Add more meeting-related questions as needed
            );
            console.log("3rd option");
            console.log(questions);


            // Update displayQuestions here
            displayQuestions();
        }
        else {
            console.log("Invalid input for LTC section");
            alert('Please enter "1", "2" or "3" for LTC');
        }
    }
    else if (questions[currentQuestion].includes("Would you like to schedule a meeting \n" + "1. Yes \n" + "2. No")) {
        console.log("Handling schedule a meeting");

        // Check if the user wants to schedule a meeting
        if (userResponse.toLowerCase() === '1') {
            console.log("User wants to schedule a meeting");
            responses[`q${currentQuestion}`] = userResponse;
            currentQuestion++;

            // Ask additional questions
            questions.push(
                "Would you prefer a consultant(enter name if known else enter none)",
                "Location (fill address or enter online)",
                "What is your preferred Day & time(EST) for the meeting?",
                "What is the subject of the meeting \n" +
                "1. Term \n" + "2. Perm \n" + "3. Auto/Home Insurance \n" +
                "4. LTC \n" + "5 Or Please enter your interested topic."

                // Add more meeting-related questions as needed
            );

            displayQuestions(); // Move displayQuestions here
        } else if (userResponse.toLowerCase() === '2') {
            console.log("User does not want to schedule a meeting");
            // If the user doesn't want to schedule a meeting, stop the process
            responses[`q${currentQuestion}`] = userResponse;
            currentQuestion++;


            displayQuestions(); // Move displayQuestions here
        } else {
            console.log("Invalid input for scheduling a meeting");
            alert('Please enter "yes" or "no" for scheduling a meeting.');
        }
    }

    else if (questions[currentQuestion].includes("What is your date of birth (YYYY-MM-DD)?")) {
    // Validate that the user entered a valid date in the format YYYY-MM-DD
    const dateOfBirthRegex = /^\d{4}-\d{2}-\d{2}$/;

    if (!dateOfBirthRegex.test(userResponse)) {
        alert('Please enter a valid date of birth in the format YYYY-MM-DD.');
        return; // Stop further processing if validation fails
    }

    responses[`q${currentQuestion}`] = userResponse;
    currentQuestion++;

    displayQuestions(); // Move displayQuestions here
}

    else if (questions[currentQuestion].includes("What is your sex")) {
    // Validate that the user entered either "1" for Male or "2" for Female
    if (userResponse !== '1' && userResponse !== '2') {
        alert('Please enter either "1" for Male or "2" for Female.');
        return; // Stop further processing if validation fails
    }

    responses[`q${currentQuestion}`] = userResponse;
    currentQuestion++;

    displayQuestions(); // Move displayQuestions here
}

else if (questions[currentQuestion].includes("age?")) {
        // Validate that the user entered a number for the age
        if (isNaN(userResponse) || userResponse.trim() === '') {
            alert('Please enter a valid number for your age.');
            return; // Stop further processing if validation fails
        }

        // You can add additional checks specific to the age question, such as a valid age range

        responses[`q${currentQuestion}`] = userResponse;
        currentQuestion++;

        displayQuestions(); // Move displayQuestions here
    }
    else if (questions[currentQuestion].includes("name?")) {
    // Validate that the user entered only letters for the first name
    const firstNameRegex = /^[a-zA-Z]+$/;

    if (!firstNameRegex.test(userResponse)) {
        alert('Please enter a valid first name with only letters.');
        return; // Stop further processing if validation fails
    }

    responses[`q${currentQuestion}`] = userResponse;
    currentQuestion++;

    displayQuestions(); // Move displayQuestions here
}

 else if (questions[currentQuestion].includes("face amount?")) {
        // Validate that the user entered a number for the age
        if (isNaN(userResponse) || userResponse.trim() === '') {
            alert('Please enter a valid number.');
            return; // Stop further processing if validation fails
        }

        // You can add additional checks specific to the age question, such as a valid age range

        responses[`q${currentQuestion}`] = userResponse;
        currentQuestion++;

        displayQuestions(); // Move displayQuestions here
    }

    else if (questions[currentQuestion].includes("1.")) {
        // Validate that the user entered a number for the age
         if (userResponse !== '1' && userResponse !== '2' && userResponse !== '3' && userResponse !== '4' && userResponse !== '5' && userResponse !== '6') {
        alert('Please chose an option');
        return; // Stop further processing if validation fails
    }

        // You can add additional checks specific to the age question, such as a valid age range

        responses[`q${currentQuestion}`] = userResponse;
        currentQuestion++;

        displayQuestions();
    }


        else if (questions[currentQuestion].includes("phone number?")) {
        // Validate that the user entered a valid phone number
        const phoneNumberRegex = /^\d{10}$/; // Simple regex for a 10-digit phone number

        if (!phoneNumberRegex.test(userResponse)) {
            alert('Please enter a valid 10-digit phone number.');
            return; // Stop further processing if validation fails
        }

        responses[`q${currentQuestion}`] = userResponse;
        currentQuestion++;

        displayQuestions();
        }
        else if (questions[currentQuestion].includes("What is your email address?")) {
    // Validate that the user entered a valid email address
    const emailRegex = /\S+@\S+\.\S+/;

    if (!emailRegex.test(userResponse)) {
        alert('Please enter a valid email address.');
        return; // Stop further processing if validation fails
    }

    responses[`q${currentQuestion}`] = userResponse;
    currentQuestion++;

    displayQuestions(); // Move displayQuestions here
} else {
        console.log("Handling other questions");
        // For other questions, you can add similar validation checks
        // ...

        // Move to the next question if validation is successful
        responses[`q${currentQuestion}`] = userResponse;
        currentQuestion++;

        displayQuestions(); // Move displayQuestions here
    }


    if (currentQuestion === questions.length) {
        alert('Your Details have been stored');
        // All questions answered, trigger API call
        console.log("Sending API call with responses:", responses); // Debugging line
        $.ajax({
            url: '/chatbot',
            data: JSON.stringify(responses),
            type: 'POST',
            contentType: "application/json",
            dataType: 'json',
            success: function (response) {
                if (response.redirect) {
                    window.location.href = response.redirect;

                }
                // Handle success
            },
            error: function (data2) {
                console.log(data2);
                // Handle error
            }
        });
    }
}





        $('#submit').on('click', handleButtonClick);
    }

    // Run on page load
    $(document).ready(function () {
        startChatbot();
    });

</script>



</body>
</html>
